var QBRecord=function(){"use strict";var t=0,e=0,i=2;"undefined"==typeof window.QuickBase&&(window.QuickBase={},$("<script />",{type:"text/javascript",src:"https://cdn.datacollaborative.com/js/quickbase/quickbase.browserify.min.js"}).appendTo("head"));var r={quickbase:{realm:window.location.host.split(".")[0],appToken:""},dbid:function(){var t=window.location.pathname.match(/^\/db\/(?!main)(.*)$/);return t?t[1]:""}(),fids:{recordid:3,primaryKey:3},recordid:-1,primaryKey:-1},n=function(t){this._data={},this._dbid="",this._fids={};var e=this,i=function(){t&&t.quickbase instanceof QuickBase&&(e._qb=t.quickbase,delete t.quickbase);var i=$.extend(!0,{},r,t||{});e.setDBID(i.dbid).setFids(i.fids).set("recordid",i.recordid).set("primaryKey",i.primaryKey),e._qb||(e._qb=new QuickBase(i.quickbase))};if("function"==typeof QuickBase)i();else var n=setInterval(function(){return-1!==["function"==typeof QuickBase].indexOf(!1)?!1:(clearInterval(n),void i())});return this};return n.prototype.clear=function(){return this._data={},this},n.prototype["delete"]=function(){var t=this;return this._qb.api("API_DeleteRecord",{dbid:this.getDBID(),rid:this.get("recordid")}).then(function(){return t.clear(),t})},n.prototype.get=function(t){return this._data.hasOwnProperty(t)?this._data[t]:null},n.prototype.getDBID=function(){return this._dbid},n.prototype.getFid=function(t,e){var i=this.getFids(),r=-1;return e!==!0?i.hasOwnProperty(t)&&(r=i[t]):(t=+t,Object.keys(i).some(function(e){return i[e]===t?(r=i[e],!0):!1})),r},n.prototype.getFids=function(t){return this._fids},n.prototype.load=function(t){var e=this,i=this.getFids(),r=[].concat(t||[]),n=this.get("recordid");if(n)r.push("{'"+this.getFid("recordid")+"'.EX.'"+n+"'}");else{var s=this.get("primaryKey");s&&r.push("{'"+this.getFid("primaryKey")+"'.EX.'"+s+"'}")}return this._qb.api("API_DoQuery",{dbid:this._dbid,query:r.join("AND"),clist:Object.keys(i).map(function(t){return i[t]}),options:"num-1"}).then(function(t){if(0===t.table.records.length)return e;var r=t.table.records[0];return Object.keys(i).forEach(function(t){e.set(t,r[i[t]])}),r.hasOwnProperty("rid")&&e.set("recordid",r.rid),e})},n.prototype.save=function(t){var e=this,i="API_AddRecord",r={dbid:this._dbid,fields:[]},n=this.get("recordid");return n&&(i="API_EditRecord",r.rid=n),Object.keys(this.getFids()).forEach(function(i){t&&-1!==t.indexOf(i)||r.fields.push({fid:e.getFid(i),value:e.get(i)})}),this._qb.api(i,r).then(function(t){return e.set("recordid",t.rid),e})},n.prototype.set=function(t,e){return this._data[t]=e,this},n.prototype.setDBID=function(t){return this._dbid=t,this},n.prototype.setFid=function(t,e){return this._fids[t]=+e,this},n.prototype.setFids=function(t){var e=this;return Object.keys(t).forEach(function(i){e.setFid(i,t[i])}),this},n.VERSION=[t,e,i].join("."),n}();
