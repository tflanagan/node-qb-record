var QBRecord=function(){"use strict";var t=0,e=0,i=5;"undefined"==typeof window.QuickBase&&(window.QuickBase={},$("<script />",{type:"text/javascript",src:"https://cdn.datacollaborative.com/js/quickbase/quickbase.browserify.min.js"}).appendTo("head"));var r={quickbase:{realm:window.location.host.split(".")[0],appToken:""},dbid:function(){var t=window.location.pathname.match(/^\/db\/(?!main)(.*)$/);return t?t[1]:""}(),fids:{recordid:3,primaryKey:3},recordid:null,primaryKey:null},n=function(t){this._data={},this._dbid="",this._fids={},this._fields=[];var e=this,i=function(){t&&t.quickbase instanceof QuickBase&&(e._qb=t.quickbase,delete t.quickbase);var i=$.extend(!0,{},r,t||{});e.setDBID(i.dbid).setFids(i.fids).set("recordid",i.recordid).set("primaryKey",i.primaryKey),e._qb||(e._qb=new QuickBase(i.quickbase))};if("function"==typeof QuickBase)i();else var n=setInterval(function(){return-1!==["function"==typeof QuickBase].indexOf(!1)?!1:(clearInterval(n),void i())});return this};n.prototype.clear=function(){return this._data={},this},n.prototype["delete"]=function(){var t=this;return this._qb.api("API_DeleteRecord",{dbid:this.getDBID(),rid:this.get("recordid")}).then(function(){return t.clear(),t})},n.prototype.get=function(t){return this._data.hasOwnProperty(t)?this._data[t]:null},n.prototype.getDBID=function(){return this._dbid},n.prototype.getFid=function(t,e){var i=this.getFids(),r=-1;return e!==!0?i.hasOwnProperty(t)&&(r=i[t]):(t=+t,Object.keys(i).some(function(e){return i[e]===t?(r=e,!0):!1})),r},n.prototype.getFids=function(t){return this._fids},n.prototype.getField=function(t){var e=this.getFields(),i=o(e,"id",+t);if(-1!==i)return e[i]},n.prototype.getFields=function(){return this._fields},n.prototype.load=function(t){var e=this,i=this.getFids(),r=[].concat(t||[]),n=this.get("recordid");if(n)r.push("{'"+this.getFid("recordid")+"'.EX.'"+n+"'}");else{var o=this.get("primaryKey");o&&r.push("{'"+this.getFid("primaryKey")+"'.EX.'"+o+"'}")}return this._qb.api("API_DoQuery",{dbid:this._dbid,query:r.join("AND"),clist:Object.keys(i).map(function(t){return i[t]}),options:"num-1"}).then(function(t){if(e._fields=t.table.fields,0===t.table.records.length)return e;var r=t.table.records[0];return Object.keys(i).forEach(function(t){e.set(t,r[i[t]])}),r.hasOwnProperty("rid")&&e.set("recordid",r.rid),e})},n.prototype.save=function(){var t=this,e="API_AddRecord",i={dbid:this._dbid,fields:[]},r=this.get("recordid");return r&&(e="API_EditRecord",i.rid=r),Object.keys(this.getFids()).forEach(function(e){var r=t.getFid(e),n=t.getField(r);5>=r||n&&-1!==["summary","virtual","lookup"].indexOf(n.mode)||i.fields.push({fid:r,value:t.get(e)})}),this._qb.api(e,i).then(function(e){return t.set("recordid",e.rid),t})},n.prototype.set=function(t,e){return this._data[t]=e,this},n.prototype.setDBID=function(t){return this._dbid=t,this},n.prototype.setFid=function(t,e){return this._fids[t]=+e,this},n.prototype.setFids=function(t){var e=this;return Object.keys(t).forEach(function(i){e.setFid(i,t[i])}),this};var o=function(t,e,i){if("object"!=typeof t)return-1;for(var r,n=0,o=t.length,d=0,a=0;o>n;++n)if("object"==typeof e){for(r=new Array(e.length),r=s(r,!1),d=0,a=r.length;a>d;++d)t[n][e[d]]===i[d]&&(r[d]=!0);if(-1===r.indexOf(!1))return n}else if(t[n][e]===i)return n;return-1},s=function(t,e){for(var i=0;i<t.length;++i)t[i]=e;return t};return n.VERSION=[t,e,i].join("."),n}();
